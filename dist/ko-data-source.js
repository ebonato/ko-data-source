/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var n;
function C(t){var q=function(){var d=function(){function d(a,d){return Object.prototype.hasOwnProperty.call(a,d)}return{Qb:function(a,d){if(a===d)return!0;var h=!!d&&"function"===typeof d.valueOf;return!!a&&"function"===typeof a.valueOf&&h&&a.valueOf()===d.valueOf()},extend:function(a,d){Array.prototype.slice.call(arguments,1).forEach(function(h){for(var f=Object.keys(h),e=0,c=f.length;e<c;e++){var p=f[e],m=Object.getOwnPropertyDescriptor(h,p);void 0!==m&&m.enumerable&&Object.defineProperty(a,p,m)}});
return a},Ha:function(a,g){for(var h in a)d(a,h)&&g(h,a[h])},I:d,$b:function(a,g){var h={},f;for(f in a)d(a,f)&&(h[f]=g(a[f],f,a));return h}}}();return function(d,a,g){return{w:d,a:a,va:g}}(function(d){function a(e){return e.filter(function(c,e,m){return m.lastIndexOf(c)===e})}function g(e,c){for(var a=e.length,m=-1,b=0;b<a;++b)if(c(e[b])){if(0<=m)throw Error("Multiple elements match the predicate.");m=b}return m}function h(e,c){return e&&"function"===typeof e.valueOf&&c&&"function"===typeof c.valueOf?
e.valueOf()<=c.valueOf()?e.valueOf()<c.valueOf()?-1:0:1:e<=c?e<c?-1:0:1}function f(e,c,a){var m=e.length,b=Array(m),l=Array(m),u;for(u=0;u<m;++u)b[u]=u,l[u]=e[u];!0===a&&(a=e,e=l,l=a);b.sort(function(b,l){return c(e[b],e[l])||b-l});for(u=0;u<m;++u)l[u]=e[b[u]];return l}return{contains:function(e,c){return 0<=e.indexOf(c)},Tb:function(e){if(50<e.length){for(var c=e.length,f={},m,b=0;b<c;++b)if(m=e[b],"string"===typeof m)if(d.I(f,m))break;else f[m]=!0;else if(e.lastIndexOf(m)!==b)break;if(!(b>=c)){for(var l=
e.slice(0,b);b<c;++b)m=e[b],"string"===typeof m?d.I(f,m)||(f[m]=!0,l.push(m)):e.lastIndexOf(m)===b&&l.push(m);e=l}}else e=a(e);return e},Ub:function(e,c){return Array.prototype.concat.apply([],e.map(c))},lb:function(e,c){c=g(e,c);if(0>c)throw Error("None of the elements matches the predicate.");return e[c]},ua:function(e,c){c=g(e,c);return 0<=c?e[c]:null},La:function(e,c){c=c||h;window.chrome?e=f(e,c,!0):e.sort(c);return e}}}(d),d,{Rb:function(d){return d.replace(/([A-Z])/g,function(a){return"-"+
a.toLowerCase()})},Sb:function(d){return d.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(d){var a=arguments;return d.replace(/{(\d+)}/g,function(d,h){h=parseInt(h,10)+1;return typeof a.length<=h?d:a[h]})}})}();var w=function(d){return function(d){function a(a){var e={get length(){return this.length},contains:function(c){return 0<=this.Ma(c)},filter:function(c){for(var e=this.length,a=[],b=0;b<e;++b){var l=this.get(b);c(l,b,this)&&a.push(l)}return new g(a)},forEach:function(c){for(var e=
this.length,a=0;a<e;++a)c(this.get(a),a,this)},get:function(c){return this.get(c)},map:function(c){for(var e=this.length,a=Array(e),b=0;b<e;++b)a[b]=c(this.get(b),b,this);return new g(a)},readOnly:function(){return new h(this)},reduce:function(c,e){var a=1<arguments.length,b=this.length;if(!a&&0===b)throw new TypeError("An empty list can not be reduced, specify an initial value.");var l=a?e:this.get(0);for(a=a?0:1;a<b;++a)l=c(l,this.get(a));return l},slice:function(c,e){var a=this.length;c=0>=arguments.length?
0:0<=c?c:a+c;e=1>=arguments.length?a:0<=e?e:a+e;a=e-c;for(var b=Array(a),l=0;l<a;++l)b[l]=this.get(c+l);return new g(b)},S:function(){for(var c=this.length,e=Array(c),a=0;a<c;++a)e[a]=this.get(a);return e},Ma:function(c){for(var e=this.length,a=0;a<e;++a)if(this.get(a)===c)return a;return-1}};return d.a.extend(e,{get length(){return this.length},contains:e.contains,filter:e.filter,forEach:e.forEach,get:function(c){return this.get(c)},map:e.map,readOnly:e.readOnly,reduce:e.reduce,slice:e.slice,toArray:e.S,
tryFirstIndexOf:e.Ma},a)}function g(a){this.Aa=a}function h(a){this.ca=a}g.prototype=a({get length(){return this.Aa.length},get:function(a){return this.Aa[a]},S:function(){return this.Aa.slice()}});h.prototype=a({get length(){return this.ca.length},get:function(a){return this.ca.get(a)}});return{ja:function(a){return new g(a||[])},cb:a}}(d)}(q);var D=function(d,k){return function(a,d){function h(b){if("string"!==typeof b)throw Error("Ids must be strings. (given: `"+b+"`, type: `"+typeof b+"`)");return b}
function f(b,c){return a.a.I(b,h(c))?b[c]:-1}function e(b,c){b=f(b,c);if(0>b)throw Error("No element with id `"+c+"`.");return b}function c(b,a,e,d,f){if(d>=f)return d;var l=Math.floor((d+f)/2);return 0>a(e,b[l])?c(b,a,e,d,l):c(b,a,e,l+1,f)}function p(b,c,a,e,d){function l(e,l){var d=u.length;e=c.slice(e,l);u=u.concat(e);e.forEach(function(c){a[b(c)]=d;++d})}var u=[],f=0;e.forEach(function(b){l(f,b);f=b;d(u)});l(f,c.length);return u}function m(b){this.L=function(c){return h(b(c))};this.u=[];this.A=
{};this.F=null}m.prototype=d.cb({get length(){return this.u.length},get:function(b){return this.u[b]},Ya:function(b){return this.u[e(this.A,b)]},gc:function(b){b=f(this.A,b);return 0<=b?this.u[b]:null},clear:function(){this.u=[];this.A={}},contains:function(b){b=(0,this.L)(b);return 0<=f(this.A,b)},Ea:function(b){return 0<=f(this.A,b)},removeAll:function(b){this.kb(b.map(this.L))},kb:function(b){if(b.length){var c=this.L,a=this.u,d=this.A;b=b.map(function(b){return e(d,b)+1});b.sort(function(b,c){return b-
c});this.u=p(c,a,d,b,function(b){b=b.pop();b=c(b);delete d[b]})}},mb:function(b){var c=this.L,e=this.u,d=this.A;this.F=b;a.w.La(e,b);b=!1;for(var f=0;f<e.length;++f){var h=c(e[f]);b=b||d[h]!==f;d[h]=f}return b},wa:function(b){if(this.F)throw Error("`updateAll` must not be called on a sorted `IndexedTable`. Use a combination of order-preserving `tryUpdateAll`, `removeAll` and `insertAll` instead.");if(b.length){var c=this.L,a=this.u,d=this.A;b.forEach(function(b){var l=e(d,c(b));a[l]=b})}},ob:function(b){if(!this.F)throw Error("`tryUpdateAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `updateAll` instead.");
if(!b.length)return[];var c=this.L,a=this.u,d=this.A,f=this.F,h=[];b.forEach(function(b){var l=e(d,c(b));0!==f(b,a[l])?h.push(b):a[l]=b});return h},addAll:function(b){if(this.F)throw Error("`addAll` must not be called on an sorted `IndexedTable`. Use order-preserving `insertAll` instead.");if(b.length){var c=this.L,e=this.u,d=this.A;b.forEach(function(b){var l=c(b);if(a.a.I(d,l))throw Error("The list already contains an element with id `"+l+"`. Did you mean to call `updateAll`?.");d[l]=e.push(b)-
1})}},ab:function(b){if(!this.F)throw Error("`insertAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `addAll` instead.");if(b.length){var e=this.L,d=this.u,f=this.A,h=this.F;a.w.La(b,h);var m=0,g=[];b.forEach(function(b){b=c(d,h,b,m,d.length);g.push(b);m=b});m=0;this.u=p(e,d,f,g,function(c){var a=b[m],l=e(a),d=c.length;c.push(a);f[l]=d;++m})}}});return m}(k,d)}(w,q);var x=function(){function d(d,a,g){this.ea=d||[];this.ma=a||[];this.la=g||[]}d.prototype={get size(){return this.ea.length+
this.ma.length+this.la.length},get empty(){return!this.size},R:function(d){this.empty||d(this)}};return d}();var v={};var r=function(d,k,a,g,h){function f(e,c,f){this.qa=e;this.i=c||new a(e.da);this.N=f||d.observable(new g);this.Da=d.observable(this.i.readOnly());this.U=null;this.v=d.pureComputed(function(){this.Da();this.U||(this.U=this.i.map(this.C.D));return this.U}.bind(this));this.v.subscribe(function(){return this.U=null}.bind(this),null,"asleep")}f.prototype={get da(){return this.qa.da},get C(){return this.qa.C},
get values(){return this.Da},get X(){return this.v},ra:function(a){this.U&&(a.ea.forEach(this.C.D),this.U=this.i.map(this.C.Yb),a.la.forEach(this.C.B));this.Da.valueHasMutated()},Ca:function(){this.v&&this.i.forEach(this.C.B)},ia:function(){this.qa.ia();this.pa()},W:function(a){return new h.tb(this,a)},Z:function(a){return new h.Db(this,a)},Va:function(a,c){return new h.pb(this,a,c)}};return f}(t,q,D,x,v);var z=function(d,k,a){function g(d,f,e,c){a.call(this,{da:d,C:f},e,c);this.ba=c.subscribe(function(c){this.ra(c)}.bind(this))}
g.prototype=k.a.extend({},a.prototype,{ia:function(){},dispose:function(){this.ba.dispose();this.Ca()}});return g}(t,q,r);(function(d,k,a,g,h){function f(e,c){g.call(this,e);var f=d.observable(d.unwrap(c));this.pa=function(){f(d.unwrap(c))};this.aa=d.computed(function(){f();var e=d.unwrap(c);f(e);var b=this.i.S();e=this.qa.i.filter(e).S();b=new a(e,[],b);this.i.clear();this.i.addAll(e);this.ra(b);b.R(this.N)}.bind(this));this.ba=e.N.subscribe(function(e){var b=this.da;for(var l=this.i,f=d.unwrap(c),
h=e.ea.filter(f),g=[],m=e.la.filter(f),p=0,k=e.ma.length;p<k;p++){var q=e.ma[p],r=l.Ea(b(q));f(q)?r?g.push(q):h.push(q):r&&m.push(q)}b=new a(h,g,m);b.empty||(this.i.removeAll(b.la),this.i.wa(b.ma),this.i.addAll(b.ea),this.ra(e),b.R(this.N))}.bind(this))}f.prototype=k.a.extend({},g.prototype,{dispose:function(){this.aa.dispose();this.ba.dispose();this.Ca()}});return h.tb=f})(t,q,x,r,v);(function(d,k,a,g){function h(f,e){a.call(this,f);this.i.addAll(f.i.S());var c=d.observable(d.unwrap(e));this.pa=
function(){c(d.unwrap(e))};this.aa=d.computed(function(){c();var a=d.unwrap(e);c(a);this.i.mb(a)&&this.N.valueHasMutated()}.bind(this));this.ba=f.N.subscribe(function(c){var a=this.i.ob(c.ma);this.i.removeAll(c.la.concat(a));this.i.ab(c.ea.concat(a));this.ra(c);this.N.valueHasMutated()}.bind(this))}h.prototype=k.a.extend({},a.prototype,{W:function(){throw Error("Filtering a sorted view is not supported.");},Z:function(){throw Error("Sorting a sorted view is not supported.");},dispose:function(){this.aa.dispose();
this.ba.dispose();this.Ca()}});return g.Db=h})(t,q,r,v);(function(d,k,a,g){function h(f,e,c){function h(){return{offset:d.unwrap(e),h:d.unwrap(c)}}var g=f.C;this.Ba=f;this.b=d.observable(a.ja());this.v=null;var b=f.da,l=d.observable(h());this.pa=function(){var b=l(),c=h();b.offset===c.offset&&b.h===c.h||l(c)};this.aa=d.computed(function(){f.N();l();var c=h();l(c);var a=f.i,e=Math.min(a.length,c.offset),d=Math.min(a.length,e+c.h);c=this.b.peek();a=a.slice(e,d);a:if(c.length!==a.length)e=!0;else{for(e=
c.length-1;0<=e;--e)if(b(c.get(e))!==b(a.get(e))){e=!0;break a}e=!1}e&&(this.b(a),this.v&&(this.v(this.b.peek().map(g.D)),c.forEach(g.B)))}.bind(this))}h.prototype={get values(){return this.b},get X(){this.v||(this.v=d.observable(this.values().map(this.Ba.C.D)));return this.v},ia:function(){this.Ba.ia();this.pa()},W:function(){throw Error("Filtering a clipped view is not supported.");},Z:function(){throw Error("Sorting a clipped view is not supported.");},Va:function(){throw Error("Clipping a clipped view is not supported.");
},dispose:function(){this.aa.dispose();this.v&&this.b().forEach(this.Ba.C.B)}};return g.pb=h})(t,q,w,v);var G={Bb:z};v=function(d){function k(a,d,f){this.s=a;this.f=f?function(a,c){c=d(c);try{return a(c)}finally{f(c)}}:function(a,c){return a(d(c))}}k.prototype={forEach:function(a){this.s.forEach(this.f.bind(null,a))},map:function(a){return new k(this,a)},reduce:function(a,d){return this.s.reduce(function(d,e){return a(d,this.f(function(c){return c},e))}.bind(this),d)}};var a=k.prototype;d.a.extend(a,
{forEach:a.forEach,map:a.map,reduce:a.reduce});return k}(q);var E=function(d,k,a){function g(){return 0}function h(){return!0}function f(b,c){this.g=b;this.f=c}function e(b){this.f=b;this.s=b.O.subscribe(function(){throw Error("Illegal state: A non-optional view for this entry is still open.");})}function c(b,c,a){this.g=b;this.Vb=c;this.Xb=a;this.Za=!1;this.H=c(a);b=b.Mb(this.value);this.ha=b();this.Ia=d.observable({present:!0,observable:this.ha});this.s=b.subscribe(function(b){this.Ia({present:!!b,
observable:b})}.bind(this))}function p(b,c,a,e){this.j=b||h;this.l=c||g;this.offset=a||0;this.h=e||0===e?e:Number.POSITIVE_INFINITY;this.M=Math.max(this.j===h?p.f:p.Pa,this.l===g?p.f:p.H,0===this.offset&&this.h===Number.POSITIVE_INFINITY?p.f:p.s)}function m(b,c,a){this.key=b;this.view=c;this.J=1;this.f=a}f.prototype={gb:function(b){return new e(this.Ka(b))},Ka:function(b){return new c(this.g,this.f,b)},nb:function(b){return this.$(b).then(function(b){return new a(b,this.g.D.bind(this.g),this.g.B.bind(this.g))}.bind(this))},
Y:function(){throw Error("`"+this.constructor+"` does not implement `openView`.");},$:function(){throw Error("`"+this.constructor+"` does not implement `streamValues`.");},dispose:function(){throw Error("`"+this.constructor+"` does not implement `dispose`.");}};f.prototype=k.a.extend({},{openEntryView:f.prototype.gb,openOptionalEntryView:f.prototype.Ka,streamObservables:f.prototype.nb},f.prototype);e.prototype={get value(){return this.f.value},get observable(){return this.f.observable},dispose:function(){this.s&&
this.s.dispose();this.f.dispose()}};e.prototype=k.a.extend({},{get value(){return this.value},get observable(){return this.observable},dispose:e.prototype.dispose},e.prototype);c.prototype={f:function(){if(this.Za)throw Error("Illegal state: Entry view was already disposed.");},get value(){this.f();return this.H=this.Vb(this.Xb)},get observable(){this.f();return this.ha},get O(){this.f();return this.Ia},dispose:function(){this.f();this.Za=!0;this.s&&(this.s.dispose(),this.g.B(this.H),this.H=this.ha=
this.Ia=this.s=null)}};c.prototype=k.a.extend({},{get value(){return this.value},get observable(){return this.observable},get optionalObservable(){return this.O},dispose:c.prototype.dispose},c.prototype);p.f=0;p.Pa=1;p.H=2;p.s=3;p.Xa=function(b){return new p(b.j,b.l,b.offset,b.h)};p.prototype={ga:function(b){return this.M===b.M&&this.j===b.j&&this.l===b.l&&this.offset===b.offset&&this.h===b.h},ib:function(){if(0>=this.M)throw Error("Unsupported operation.");var b=[null,this.j,this.l].slice(0,this.M);
return new (p.bind.apply(p,b))},Ua:function(){return 0===this.M?[this]:this.ib().Ua().concat([this])},Pb:function(b){var c=[[this.j],[this.l],[this.offset,this.h]][this.M-1];return(0,[function(b){return b.W},function(b){return b.Z},function(b){return b.Va}][this.M-1])(b).apply(b,c)}};m.prototype={D:function(){if(0>=this.J)throw Error("Assertion error: Reference count at `"+this.J+"`.");++this.J;return this},B:function(){0===--this.J&&this.f();return this}};f.na=p;f.Oa=m;return f}(t,q,v);var F=function(d,
k){function a(a){this.ca=a}a.prototype={forEach:function(a){this.ca.forEach(a)},map:function(a){return new k(this,a)},reduce:function(a,d){return Promise.resolve(this.ca.reduce(a,d))}};var g=a.prototype;d.a.extend(g,{forEach:g.forEach,map:g.map,reduce:g.reduce});return a}(q,v);v=function(d){function k(a){this.G=!1;(a&&a.observableProperties||[]).forEach(function(a){this.G=this.G||{};this.G[a]=!0}.bind(this))}k.prototype={constructor:function(a){function g(c,a){Object.keys(c).forEach(function(f){"object"===
typeof c[f]&&null!==c[f]?(a[f]=c[f],c[f]&&(e+=f+".",g(c[f],a[f]),e=e.replace(f+".",""))):a[f]=h&&h[e+f]?d.isObservable(c[f])?c[f]:d.observable(c[f]):c[f]})}var h=this.G;if(!h)return a;var f={},e="";g(a,f);return f},updater:function(a,g){function h(a,e){Object.keys(a).forEach(function(c){if("object"===typeof a[c]&&null!==a[c])a[c]&&e&&h(a[c],e[c]);else if(d.isObservable(e[c])){if(d.isWritableObservable(e[c]))e[c](d.unwrap(a[c]))}else e[c]=d.unwrap(a[c])})}if(!this.G)return a;h(g,a);return a},destructor:function(){},
updateProperties:function(a){this.G=!1;(a&&a.observableProperties||[]).forEach(function(a){this.G=this.G||{};this.G[a]=!0}.bind(this))}};return k}(t);var y=function(d,k,a){function g(a){this.observable=a;this.O=d.observable(a);this.jb=1}return function(d,f){function e(a){if("string"!==typeof a)throw h(a);if(k.a.I(b,a))return b[a];throw Error("No entry for id `"+a+"`.");}function c(a){var c=d(a);if("string"!==typeof c)throw h(c);Object.prototype.hasOwnProperty.call(b,c)?(c=b[c],++c.jb):(a=new g(f.constructor(a)),
c=b[c]=a);return c}function h(b){throw Error("Illegal argument: Ids must be strings ('"+b+"' is of type '"+typeof b+"').");}function m(b){var a=b.observable;b.O(null);b.observable=null;f.destructor(a)}f=f||new a;var b={};this.D=function(b){return c(b).observable};this.Mb=function(b){return c(b).O};this.B=function(a){a=d(a);var c=e(a);0===--c.jb&&(m(c),delete b[a])};this.Yb=function(b){return e(d(b)).observable};this.hb=function(a){a.forEach(function(a){var c=d(a);k.a.I(b,c)&&(c=b[c],c.observable||
(c.observable=f.constructor(a),c.O(c.observable)))})};this.xa=function(a){a.forEach(function(a){var c=d(a);k.a.I(b,c)&&f.updater(b[c].observable,a)})};this.bc=function(a){k.a.Ha(b,function(b,c){(b=a(b))?c.observable?f.updater(c.observable,b):(c.observable=f.constructor(b),c.O(c.observable)):m(c)})};this.Wa=function(a){k.a.Ha(b,function(b,c){a(b)&&m(c)})};this.dispose=function(){this.Wa(function(){return!0})}.bind(this)}}(t,q,v);r=function(d){var k=function(a){return function(d,e){return a.a.extend(d,
{get stringifyable(){return e()}})}}(d);var a=function(a,d){function e(){return 0}function c(a,b){return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<=b?a<b?-1:0:1}function f(c,e){return a.a.extend(c,{get onResultOf(){return this.ka},get reverse(){return this.reverse},get callable(){return this.fa}},{get ka(){return function(a){return h(a,c)}},get reverse(){return function(){return e||b(c)}},get fa(){return c}})}function h(a,b){function c(c,e){return b(a(c),a(e))}f(c);d(c,function(){return{type:"by-function-comparator",
"function":a.stringifyable,comparator:b.stringifyable}});return c}function b(a){function b(b,c){return-a(b,c)}f(b,a);d(b,function(){return{type:"reversed-comparator",comparator:a.stringifyable}});return b}f(c);d(c,function(){return{type:"natural-comparator"}});f(e);d(e,function(){return{type:"indifferent-comparator"}});return{Wb:e,mc:c}}(d,k);var g=function(a,d){function e(c){return a.a.extend(c,{get callable(){return this.fa}},{get fa(){return c}})}return{ac:function(a){function c(c){return-1==a.indexOf(".")?
c[a]:eval("owner."+a)}e(c);d(c,function(){return{type:"property-accessor",propertyName:a}});return c}}}(d,k);d=function(a,d){function e(){return!0}function c(){return!1}function f(c,e){return a.a.extend(c,{get and(){return this.and},get negate(){return this.eb},get onResultOf(){return this.ka},get or(){return this.or},get callable(){return this.fa}},{get and(){return function(a){return h([c,a])}},get eb(){return function(){return e||l(c)}},get ka(){return function(a){return b(a,c)}},get or(){return function(a){return g([c,
a])}},get fa(){return c}})}function h(a){function b(b){for(var c=0,e=a.length;c<e;++c)if(!a[c](b))return!1;return!0}if(!a.length)return e;f(b);d(b,function(){return{type:"and-predicate",components:a.map(function(a){return a.stringifyable})}});return b}function b(a,b){function c(c){return b(a(c))}f(c);d(c,function(){return{type:"by-function-predicate","function":a.stringifyable,predicate:b.stringifyable}});return c}function l(a){function b(b){return!a(b)}f(b,a);d(b,function(){return{type:"negated-predicate",
predicate:a.stringifyable}});return b}function g(a){function b(b){for(var c=0,e=a.length;c<e;++c)if(a[c](b))return!0;return!1}if(!a.length)return c;f(b);d(b,function(){return{type:"or-predicate",components:a.map(function(a){return a.stringifyable})}});return b}f(c);d(c,function(){return{type:"always-false-predicate"}});f(e);d(e,function(){return{type:"always-true-predicate"}});return{lc:c,Ob:e,and:h,from:function(a,b){function c(b){return a(b)}f(c);d(c,b);return c},or:g,cc:function(a){function b(b){return a.test(b)}
f(b);d(b,function(){return{type:"regular-expression-predicate",regularExpression:a.source,caseSensitive:!a.ignoreCase,multiline:a.multiline}});return b}}}(d,k);return{V:a,sa:g,P:d,Zb:k,fc:function(a,d){return"function"===typeof d||"object"===typeof d?d.stringifyable||d:d}}}(q);r=function(d,k,a){function g(a,d,e,c){this.Jb=a;this.F=d;this.Ib=e;this.Hb=c}g.prototype=k.a.extend({get predicate(){return this.j},get comparator(){return this.l},get offset(){return this.offset},get limit(){return this.h}},
{get j(){return this.Jb},get l(){return this.F},get offset(){return this.Ib},get h(){return this.Hb},normalize:function(){return new g(this.j||a.P.Ob,this.l||a.V.Wb,this.offset||0,this.h||0===this.h?this.h:Number.POSITIVE_INFINITY)},Na:function(){return new g(d.unwrap(this.j),d.unwrap(this.l),d.unwrap(this.offset),d.unwrap(this.h))},ga:function(a){return this.j===a.j&&this.l===a.l&&this.offset===a.offset&&this.h===a.h}});return g}(t,q,r);r=function(d,k){function a(a,d,e){k.call(this,a,d,e)}var g=
{bb:function(a){return new k(this.j,this.l,this.offset,a)}};a.prototype=d.a.extend({},k.prototype,g,{limitedTo:g.bb});return a}(q,r);r=function(d,k){function a(a,d){k.call(this,a,d)}var g={fb:function(a){return new k(this.j,this.l,a)}};a.prototype=d.a.extend({},k.prototype,g,{offsetBy:g.fb});return a}(q,r);r=function(d,k){function a(a){k.call(this,a)}var g={Z:function(a){return new k(this.j,a)}};a.prototype=d.a.extend({},k.prototype,g,{sortedBy:g.Z});return a}(q,r);r=function(d,k){function a(){k.call(this)}
var g={W:function(a){return new k(a)}};a.prototype=d.a.extend({},k.prototype,g,{filteredBy:g.W});return a}(q,r);var B=function(d,k){function a(){k.call(this)}a.prototype=d.a.extend({},k.prototype);return a}(q,r);r=function(){function d(b,d){d=d||new p(b);var l=new c(b);f.call(this,d,function(a){return l.Ya(a)});this.oa=b;this.g=d;this.b=l;this.T=a.observable(new e);this.o=[];var g=new h.Bb(this.oa,this.g,this.b,this.T);this.Kb=this.Qa(new f.na,g);this.K=a.pureComputed(function(){return g.values().length})}
function k(b,c){this.f=b;this.H=c;this.K=a.pureComputed(function(){return b.values().length});this.s=a.pureComputed(function(){return(g.w.ua(c,function(a){return a.key.M===f.na.Pa})||c[0]).view.values().length})}var a=t,g=q,h=G,f=E,e=x,c=D,p=y;d.prototype={get size(){return this.K},Qa:function(a,c){var b=new f.Oa(a,c,function(){return this.o.splice(this.o.indexOf(b),1)}.bind(this));this.o.push(b);return b},Gb:function(a){var b=g.w.ua(this.o,function(b){return a.ga(b.key)});if(b)return b.D();var c=
a.ib();b=g.w.lb(this.o,function(a){return c.ga(a.key)}).view;b=a.Pb(b);return this.Qa(a,b)},Lb:function(a){this.b.addAll(a);(new e(a)).R(this.T);this.g.hb(a)},Nb:function(a){var b=[],c=[];a.forEach(function(a){return(this.b.contains(a)?c:b).push(a)}.bind(this));this.b.addAll(b);this.b.wa(c);(new e(b,c)).R(this.T);this.g.hb(b);this.g.xa(c)},Y:function(a){a=(a||function(a){return a})(new B);a=f.na.Xa(a).Ua().map(function(a){return this.Gb(a)}.bind(this));var b=a[a.length-1].view;b.ia();return new k(b,
a)},dc:function(a){this.b.removeAll(a);(new e([],[],a)).R(this.T);this.g.Wa(function(a){return!this.b.Ea(a)}.bind(this))},ec:function(a){var b=this.b.S();this.b.clear();this.b.addAll(a);(new e(a,[],b)).R(this.T);this.g.bc(function(a){return this.b.gc(a)}.bind(this))},$:function(a){a=this.Y(a);try{return Promise.resolve(new F(a.values.peek().slice()))}finally{a.dispose()}},xa:function(a){this.b.wa(a);(new e([],a)).R(this.T);this.g.xa(a)},dispose:function(){this.Kb.B();this.g.dispose();if(this.o.length){var a=
this.o.length,c=this.o.reduce(function(a,c){return a+c.J},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+c+" references).")}}};d.prototype=g.a.extend({},f.prototype,{get size(){return this.size},addEntries:d.prototype.Lb,dispose:d.prototype.dispose,addOrUpdateEntries:d.prototype.Nb,openView:d.prototype.Y,removeEntries:d.prototype.dc,replaceEntries:d.prototype.ec,streamValues:d.prototype.$,updateEntries:d.prototype.xa},d.prototype);var m=a.pureComputed(function(){return!1});
k.prototype={get Fa(){return m},get Ga(){return this.s},get Ja(){return a.pureComputed(function(){return{}})},get X(){return this.f.X},get size(){return this.K},get values(){return this.f.values},dispose:function(){this.H.forEach(function(a){a.B()})}};k.prototype=g.a.extend({get dirty(){return this.Fa},get filteredSize(){return this.Ga},get metadata(){return this.Ja},get observables(){return this.X},get size(){return this.size},get values(){return this.values},dispose:k.prototype.dispose},k.prototype);
return d}({});z=function(){function d(c,d,g){g=g||new f(c);var b={};h.call(this,g,function(a){if(!e(b,a))throw Error("No known entry with id `"+a+"`.");return b[a].value});this.oa=c;this.g=g;this.Sa=d;this.b=b;this.K=a.observable(0);this.Fb=a.pureComputed(function(){return this.K()}.bind(this));this.o=[]}function k(c,d,e){function b(a){if(a.j!==w||a.l!==x)return!1;for(var c=0,b=t.length;c<b;++c){var d=v[c];if(t[c]<=a.offset&&d>=a.offset+a.h)return!0}return!1}function f(a,c){if(a.j!==w||a.l!==x){var b=
a.j,d=a.l;r=[];t=[];v=[];w=b;x=d}d=b=a.offset;a=b+a.h;var e,f;var g=e=0;for(f=t.length;e<f;++e){var h=t[g]=t[e],k=v[g]=v[e];d<=k&&a>=h?(d=Math.min(h,d),a=Math.max(k,a)):++g}t.length=v.length=g;t.push(d);v.push(a>=m().filteredSize?Number.POSITIVE_INFINITY:a);e=0;for(f=c.length;e<f;++e)r[b+e]=c[e]}var h=a.observable(!1),k=a.observable(!1),m=a.observable({unfilteredSize:c.size.peek(),filteredSize:0}),p=g.ja(),q=a.observable(),r=[],t=[],v=[],w=null,x=null,z=a.pureComputed(function(){if(h.peek())return h();
var a=d.Na().normalize();if(b(a))return q(r.slice(a.offset,a.offset+a.h));k(!0);h(!0);window.setTimeout(function(){if(!a.ga(d.Na().normalize()))return h(!1);c.Sa.issue(a).then(function(b){var d=[];b.values.reduce(function(a,c){return d.push(c)});q(d);delete b.values;c.K(b.unfilteredSize);m(b);f(a,d)}).then(function(){k(!1);h(!1)},function(){h(!1)})})}),y=a.pureComputed(function(){z();var a=q();a=g.ja(a);A?(A=a.map(function(a){c.Ra(a);return c.g.D(a)}),p.forEach(function(a){c.Ta(a);c.g.B(a)})):(a.forEach(c.Ra.bind(c)),
p.forEach(c.Ta.bind(c)));return p=a});this.b=y;var A=null;this.v=a.pureComputed(function(){y();A||(A=p.map(c.g.D));return A});this.v.subscribe(function(){return A=null},null,"asleep");this.s=a.pureComputed(function(){return k()});this.ha=a.pureComputed(function(){return m()});this.f=a.pureComputed(function(){return m().filteredSize});this.K=a.pureComputed(function(){return y().length});this.H=function(){z.dispose();e()}}var a=t,g=w,h=E,f=y,e=q.a.I;d.prototype={get size(){return this.Fb},Ra:function(a){var c=
this.oa(a);e(this.b,c)?(c=this.b[c],++c.J,c.value=a):this.b[c]={J:1,value:a}},Ta:function(a){a=this.oa(a);if(!e(this.b,a))throw Error("Assertion error: Value with id `"+a+"` was expected to be referenced.");0===--this.b[a].J&&delete this.b[a]},Y:function(a){a=(a||function(a){return a})(new B);var c=h.na.Xa(a),d=q.w.ua(this.o,function(a){return c.ga(a.key)});if(d)return d.D().view;a=new k(this,a,function(){return b.B()});var b=new h.Oa(c,a,function(){return this.o.splice(this.o.indexOf(b),1)}.bind(this));
this.o.push(b);return a},$:function(a){a=(a||function(a){return a})(new B);return this.Sa.issue(a.Na().normalize()).then(function(a){return a.values})},dispose:function(){this.g.dispose();if(this.o.length){var a=this.o.length,d=this.o.reduce(function(a,b){return a+b.J},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+d+" references).")}}};d.prototype=q.a.extend({},h.prototype,{get size(){return this.size},dispose:d.prototype.dispose,openView:d.prototype.Y,streamValues:d.prototype.$},
d.prototype);k.prototype={get Fa(){return this.s},get Ga(){return this.f},get Ja(){return this.ha},get X(){return this.v},get size(){return this.K},get values(){return this.b},dispose:function(){this.H()}};k.prototype=q.a.extend({},{get dirty(){return this.Fa},get filteredSize(){return this.Ga},get metadata(){return this.Ja},get observables(){return this.X},get size(){return this.size},get values(){return this.values},dispose:k.prototype.dispose},k.prototype);return d}({});return function(d,k,a,g,
h){return{ClientSideDataSource:d,DefaultObservableStateTransitioner:k,ObservableEntries:a,ServerSideDataSource:g,streams:h}}(r,v,y,z,function(d,k){return{streamArray:function(a){return new k(d.ja(a))}}}(w,F))}"function"===typeof define&&define.amd?define(["knockout"],C):window["ko-data-source"]=C(window.ko);