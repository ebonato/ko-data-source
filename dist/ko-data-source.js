/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var p;
function F(t){var q,v,C,w,u,r,y,G,D,E,x,B;q=function(){var a;a=function(){function a(e,a){return Object.prototype.hasOwnProperty.call(e,a)}return{Tb:function(e,a){if(e===a)return!0;var m=!!a&&"function"===typeof a.valueOf;return!!e&&"function"===typeof e.valueOf&&m&&e.valueOf()===a.valueOf()},extend:function(e,a){Array.prototype.slice.call(arguments,1).forEach(function(a){for(var h=Object.keys(a),d=0,c=h.length;d<c;d++){var f=h[d],n=Object.getOwnPropertyDescriptor(a,f);n&&n.enumerable&&Object.defineProperty(e,f,
n)}});return e},Ka:function(e,g){for(var m in e)a(e,m)&&g(m,e[m])},I:a,cc:function(e,g){var m={},h;for(h in e)a(e,h)&&(m[h]=g(e[h],h,e));return m}}}();return function(a,e,g){return{w:a,a:e,ya:g}}(function(a){function e(d){return d.filter(function(c,d,n){return n.lastIndexOf(c)===d})}function g(d,c){for(var f=d.length,n=-1,b=0;b<f;++b)if(c(d[b])){if(0<=n)throw Error("Multiple elements match the predicate.");n=b}return n}function m(d,c){return d&&"function"===typeof d.valueOf&&c&&"function"===typeof c.valueOf?
d.valueOf()<=c.valueOf()?d.valueOf()<c.valueOf()?-1:0:1:d<=c?d<c?-1:0:1}function h(d,c){var f=d.length,n=Array(f),b=Array(f),l;for(l=0;l<f;++l)n[l]=l,b[l]=d[l];l=d;d=b;b=l;n.sort(function(b,l){return c(d[b],d[l])||b-l});for(l=0;l<f;++l)b[l]=d[n[l]];return b}return{contains:function(d,c){return 0<=d.indexOf(c)},Wb:function(d){if(50<d.length){for(var c=d.length,f={},n,b=0;b<c;++b)if(n=d[b],"string"===typeof n)if(a.I(f,n))break;else f[n]=!0;else if(d.lastIndexOf(n)!==b)break;if(!(b>=c)){for(var l=d.slice(0,
b);b<c;++b)n=d[b],"string"===typeof n?a.I(f,n)||(f[n]=!0,l.push(n)):d.lastIndexOf(n)===b&&l.push(n);d=l}}else d=e(d);return d},Xb:function(d,c){return Array.prototype.concat.apply([],d.map(c))},ob:function(d,c){var f=g(d,c);if(0>f)throw Error("None of the elements matches the predicate.");return d[f]},wa:function(d,c){var f=g(d,c);return 0<=f?d[f]:null},Oa:function(d,c){var f=c||m;window.chrome?f=h(d,f):(d.sort(f),f=d);return f}}}(a),a,{Ub:function(a){return a.replace(/([A-Z])/g,function(e){return"-"+
e.toLowerCase()})},Vb:function(a){return a.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})},format:function(a){var e=arguments;return a.replace(/{(\d+)}/g,function(a,m){var h=parseInt(m,10)+1;return typeof e.length<=h?a:e[h]})}})}();v=function(a){return function(a){function e(e){var d={get length(){return this.length},contains:function(c){return 0<=this.Pa(c)},filter:function(c){for(var d=this.length,a=[],b=0;b<d;++b){var l=this.get(b);c(l,b,this)&&a.push(l)}return new g(a)},forEach:function(c){for(var d=
this.length,a=0;a<d;++a)c(this.get(a),a,this)},get:function(c){return this.get(c)},map:function(c){for(var d=this.length,a=Array(d),b=0;b<d;++b)a[b]=c(this.get(b),b,this);return new g(a)},readOnly:function(){return new m(this)},reduce:function(c,d){var a=1<arguments.length,b=this.length;if(!a&&0===b)throw new TypeError("An empty list can not be reduced, specify an initial value.");for(var l=a?d:this.get(0),a=a?0:1;a<b;++a)l=c(l,this.get(a));return l},slice:function(c,d){var a=this.length;c=0>=arguments.length?
0:0<=c?c:a+c;d=1>=arguments.length?a:0<=d?d:a+d;for(var a=d-c,b=Array(a),l=0;l<a;++l)b[l]=this.get(c+l);return new g(b)},S:function(){for(var c=this.length,d=Array(c),a=0;a<c;++a)d[a]=this.get(a);return d},Pa:function(c){for(var d=this.length,a=0;a<d;++a)if(this.get(a)===c)return a;return-1}};return a.a.extend(d,{get length(){return this.length},contains:d.contains,filter:d.filter,forEach:d.forEach,get:function(c){return this.get(c)},map:d.map,readOnly:d.readOnly,reduce:d.reduce,slice:d.slice,toArray:d.S,
tryFirstIndexOf:d.Pa},e)}function g(a){this.Da=a}function m(a){this.ca=a}g.prototype=e({get length(){return this.Da.length},get:function(a){return this.Da[a]},S:function(){return this.Da.slice()}});m.prototype=e({get length(){return this.ca.length},get:function(a){return this.ca.get(a)}});return{ja:function(a){return new g(a||[])},gb:e}}(a)}(q);C=function(a,k){return function(a,g){function e(b){if("string"!==typeof b)throw Error("Ids must be strings. (given: `"+b+"`, type: `"+typeof b+"`)");return b}
function h(b,l){return a.a.I(b,e(l))?b[l]:-1}function d(b,l){var a=h(b,l);if(0>a)throw Error("No element with id `"+l+"`.");return a}function c(b,a,d,e,f){if(e>=f)return e;var l=Math.floor((e+f)/2);return 0>a(d,b[l])?c(b,a,d,e,l):c(b,a,d,l+1,f)}function f(b,a,c,d,e){function l(l,d){var e=f.length,z=a.slice(l,d);f=f.concat(z);z.forEach(function(a){c[b(a)]=e;++e})}var f=[],z=0;d.forEach(function(b){l(z,b);z=b;e(f)});l(z,a.length);return f}function n(b){this.L=function(a){return e(b(a))};this.u=[];this.A=
{};this.F=null}n.prototype=g.gb({get length(){return this.u.length},get:function(b){return this.u[b]},ab:function(b){return this.u[d(this.A,b)]},jc:function(b){b=h(this.A,b);return 0<=b?this.u[b]:null},clear:function(){this.u=[];this.A={}},contains:function(b){b=(0,this.L)(b);return 0<=h(this.A,b)},Ha:function(b){return 0<=h(this.A,b)},removeAll:function(b){this.nb(b.map(this.L))},nb:function(b){if(b.length){var a=this.L,c=this.u,e=this.A;b=b.map(function(b){return d(e,b)+1});b.sort(function(b,a){return b-
a});this.u=f(a,c,e,b,function(b){b=b.pop();b=a(b);delete e[b]})}},pb:function(b){var c=this.L,d=this.u,e=this.A;this.F=b;a.w.Oa(d,b);b=!1;for(var f=0;f<d.length;++f){var h=c(d[f]);b=b||e[h]!==f;e[h]=f}return b},za:function(b){if(this.F)throw Error("`updateAll` must not be called on a sorted `IndexedTable`. Use a combination of order-preserving `tryUpdateAll`, `removeAll` and `insertAll` instead.");if(b.length){var a=this.L,c=this.u,e=this.A;b.forEach(function(b){var l=d(e,a(b));c[l]=b})}},rb:function(b){if(!this.F)throw Error("`tryUpdateAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `updateAll` instead.");
if(!b.length)return[];var a=this.L,c=this.u,e=this.A,f=this.F,h=[];b.forEach(function(b){var l=d(e,a(b));0!==f(b,c[l])?h.push(b):c[l]=b});return h},addAll:function(b){if(this.F)throw Error("`addAll` must not be called on an sorted `IndexedTable`. Use order-preserving `insertAll` instead.");if(b.length){var c=this.L,d=this.u,e=this.A;b.forEach(function(b){var l=c(b);if(a.a.I(e,l))throw Error("The list already contains an element with id `"+l+"`. Did you mean to call `updateAll`?.");e[l]=d.push(b)-
1})}},eb:function(b){if(!this.F)throw Error("`insertAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `addAll` instead.");if(b.length){var d=this.L,e=this.u,h=this.A,m=this.F;a.w.Oa(b,m);var n=0,g=[];b.forEach(function(b){b=c(e,m,b,n,e.length);g.push(b);n=b});n=0;this.u=f(d,e,h,g,function(a){var c=b[n],l=d(c),e=a.length;a.push(c);h[l]=e;++n})}}});return n}(k,a)}(v,q);w=function(){function a(a,e,g){this.ea=a||[];this.ma=e||[];this.la=g||[]}a.prototype={get size(){return this.ea.length+
this.ma.length+this.la.length},get empty(){return!this.size},R:function(a){this.empty||a(this)}};return a}();u={};r=function(a,k,e,g,m){function h(d,c,f){this.qa=d;this.i=c||new e(d.da);this.N=f||a.observable(new g);this.Ga=a.observable(this.i.readOnly());this.U=null;this.v=a.pureComputed(function(){this.Ga();this.U||(this.U=this.i.map(this.C.D));return this.U}.bind(this));this.v.subscribe(function(){return this.U=null}.bind(this),null,"asleep")}h.prototype={get da(){return this.qa.da},get C(){return this.qa.C},
get values(){return this.Ga},get X(){return this.v},ra:function(a){this.U&&(a.ea.forEach(this.C.D),this.U=this.i.map(this.C.ac),a.la.forEach(this.C.B));this.Ga.valueHasMutated()},Fa:function(){this.v&&this.i.forEach(this.C.B)},ia:function(){this.qa.ia();this.pa()},W:function(a){return new m.wb(this,a)},Z:function(a){return new m.Gb(this,a)},Ya:function(a,c){return new m.sb(this,a,c)}};return h}(t,q,C,w,u);y=function(a,k,e){function g(a,h,d,c){e.call(this,{da:a,C:h},d,c);this.ba=c.subscribe(function(a){this.ra(a)}.bind(this))}
g.prototype=k.a.extend({},e.prototype,{ia:function(){},dispose:function(){this.ba.dispose();this.Fa()}});return g}(t,q,r);(function(a,k,e,g,m){function h(d,c){g.call(this,d);var f=a.observable(a.unwrap(c));this.pa=function(){return f(a.unwrap(c))};this.aa=a.computed(function(){f();var d=a.unwrap(c);f(d);var b=this.i.S(),d=this.qa.i.filter(d).S(),b=new e(d,[],b);this.i.clear();this.i.addAll(d);this.ra(b);b.R(this.N)}.bind(this));this.ba=d.N.subscribe(function(d){var b;b=this.da;for(var l=this.i,f=
a.unwrap(c),h=d.ea.filter(f),m=[],g=d.la.filter(f),n=0,k=d.ma.length;n<k;n++){var q=d.ma[n],r=l.Ha(b(q));f(q)?r?m.push(q):h.push(q):r&&g.push(q)}b=new e(h,m,g);b.empty||(this.i.removeAll(b.la),this.i.za(b.ma),this.i.addAll(b.ea),this.ra(d),b.R(this.N))}.bind(this))}h.prototype=k.a.extend({},g.prototype,{dispose:function(){this.aa.dispose();this.ba.dispose();this.Fa()}});return m.wb=h})(t,q,w,r,u);(function(a,k,e,g){function m(h,d){e.call(this,h);this.i.addAll(h.i.S());var c=a.observable(a.unwrap(d));
this.pa=function(){return c(a.unwrap(d))};this.aa=a.computed(function(){c();var e=a.unwrap(d);c(e);this.i.pb(e)&&this.N.valueHasMutated()}.bind(this));this.ba=h.N.subscribe(function(a){var c=this.i.rb(a.ma);this.i.removeAll(a.la.concat(c));this.i.eb(a.ea.concat(c));this.ra(a);this.N.valueHasMutated()}.bind(this))}m.prototype=k.a.extend({},e.prototype,{W:function(){throw Error("Filtering a sorted view is not supported.");},Z:function(){throw Error("Sorting a sorted view is not supported.");},dispose:function(){this.aa.dispose();
this.ba.dispose();this.Fa()}});return g.Gb=m})(t,q,r,u);(function(a,k,e,g){function m(h,d,c){function f(){return{offset:a.unwrap(d),h:a.unwrap(c)}}var m=h.C;this.Ea=h;this.b=a.observable(e.ja());this.v=null;var b=h.da,l=a.observable(f());this.pa=function(){var b=l(),a=f();b.offset===a.offset&&b.h===a.h||l(a)};this.aa=a.computed(function(){h.N();l();var a=f();l(a);var c=h.i,d=Math.min(c.length,a.offset),e=Math.min(c.length,d+a.h),a=this.b.peek(),c=c.slice(d,e);a:if(a.length!==c.length)d=!0;else{for(d=
a.length-1;0<=d;--d)if(b(a.get(d))!==b(c.get(d))){d=!0;break a}d=!1}d&&(this.b(c),this.v&&(this.v(this.b.peek().map(m.D)),a.forEach(m.B)))}.bind(this))}m.prototype={get values(){return this.b},get X(){this.v||(this.v=a.observable(this.values().map(this.Ea.C.D)));return this.v},ia:function(){this.Ea.ia();this.pa()},W:function(){throw Error("Filtering a clipped view is not supported.");},Z:function(){throw Error("Sorting a clipped view is not supported.");},Ya:function(){throw Error("Clipping a clipped view is not supported.");
},dispose:function(){this.aa.dispose();this.v&&this.b().forEach(this.Ea.C.B)}};return g.sb=m})(t,q,v,u);G={Eb:y};u=function(a){function k(a,e,h){this.s=a;this.f=h?function(a,c){var d=e(c);try{return a(d)}finally{h(d)}}:function(a,c){return a(e(c))}}k.prototype={forEach:function(a){this.s.forEach(this.f.bind(null,a))},map:function(a){return new k(this,a)},reduce:function(a,e){return this.s.reduce(function(e,d){return a(e,this.f(function(a){return a},d))}.bind(this),e)}};var e=k.prototype;a.a.extend(e,
{forEach:e.forEach,map:e.map,reduce:e.reduce});return k}(q);D=function(a,k,e){function g(){return 0}function m(){return!0}function h(b,a){this.g=b;this.f=a}function d(b){this.f=b;this.s=b.O.subscribe(function(){throw Error("Illegal state: A non-optional view for this entry is still open.");})}function c(b,c,d){this.g=b;this.Yb=c;this.$b=d;this.bb=!1;this.H=c(d);b=b.Pb(this.value);this.ha=b();this.La=a.observable({present:!0,observable:this.ha});this.s=b.subscribe(function(b){this.La({present:!!b,
observable:b})}.bind(this))}function f(b,a,c,d){this.j=b||m;this.l=a||g;this.offset=c||0;this.h=d||0===d?d:Number.POSITIVE_INFINITY;this.M=Math.max(this.j===m?f.f:f.Sa,this.l===g?f.f:f.H,0===this.offset&&this.h===Number.POSITIVE_INFINITY?f.f:f.s)}function n(b,a,c){this.key=b;this.view=a;this.J=1;this.f=c}h.prototype={jb:function(b){return new d(this.Na(b))},Na:function(b){return new c(this.g,this.f,b)},qb:function(b){return this.$(b).then(function(b){return new e(b,this.g.D.bind(this.g),this.g.B.bind(this.g))}.bind(this))},
Y:function(){throw Error("`"+this.constructor+"` does not implement `openView`.");},$:function(){throw Error("`"+this.constructor+"` does not implement `streamValues`.");},dispose:function(){throw Error("`"+this.constructor+"` does not implement `dispose`.");}};h.prototype=k.a.extend({},{openEntryView:h.prototype.jb,openOptionalEntryView:h.prototype.Na,streamObservables:h.prototype.qb},h.prototype);d.prototype={get value(){return this.f.value},get observable(){return this.f.observable},dispose:function(){this.s&&
this.s.dispose();this.f.dispose()}};d.prototype=k.a.extend({},{get value(){return this.value},get observable(){return this.observable},dispose:d.prototype.dispose},d.prototype);c.prototype={f:function(){if(this.bb)throw Error("Illegal state: Entry view was already disposed.");},get value(){this.f();return this.H=this.Yb(this.$b)},get observable(){this.f();return this.ha},get O(){this.f();return this.La},dispose:function(){this.f();this.bb=!0;this.s&&(this.s.dispose(),this.g.B(this.H),this.H=this.ha=
this.La=this.s=null)}};c.prototype=k.a.extend({},{get value(){return this.value},get observable(){return this.observable},get optionalObservable(){return this.O},dispose:c.prototype.dispose},c.prototype);f.f=0;f.Sa=1;f.H=2;f.s=3;f.$a=function(b){return new f(b.j,b.l,b.offset,b.h)};f.prototype={ga:function(b){return this.M===b.M&&this.j===b.j&&this.l===b.l&&this.offset===b.offset&&this.h===b.h},lb:function(){if(0>=this.M)throw Error("Unsupported operation.");var b=[null,this.j,this.l].slice(0,this.M);
return new (f.bind.apply(f,b))},Xa:function(){return this.M?this.lb().Xa().concat([this]):[this]},Sb:function(b){var a=[[this.j],[this.l],[this.offset,this.h]][this.M-1];return(0,[function(b){return b.W},function(b){return b.Z},function(b){return b.Ya}][this.M-1])(b).apply(b,a)}};n.prototype={D:function(){if(0>=this.J)throw Error("Assertion error: Reference count at `"+this.J+"`.");++this.J;return this},B:function(){--this.J||this.f();return this}};h.na=f;h.Ra=n;return h}(t,q,u);E=function(a,k){function e(a){this.ca=
a}e.prototype={forEach:function(a){this.ca.forEach(a)},map:function(a){return new k(this,a)},reduce:function(a,e){return Promise.resolve(this.ca.reduce(a,e))}};var g=e.prototype;a.a.extend(g,{forEach:g.forEach,map:g.map,reduce:g.reduce});return e}(q,u);u=function(a){function k(a){this.G=!1;(a&&a.observableProperties||[]).forEach(function(a){this.G=this.G||{};this.G[a]=!0}.bind(this))}k.prototype={constructor:function(e){function g(c,e){Object.keys(c).forEach(function(f){"object"===typeof c[f]&&null!==
c[f]?(e[f]=c[f],c[f]&&(d+=f+".",g(c[f],e[f]),d=d.replace(f+".",""))):e[f]=m&&m[d+f]?a.isObservable(c[f])?c[f]:a.observable(c[f]):c[f]})}var m=this.G;if(!m)return e;var h={},d="";g(e,h);return h},updater:function(e,g){function m(e,d){Object.keys(e).forEach(function(c){if("object"===typeof e[c]&&null!==e[c])e[c]&&d&&m(e[c],d[c]);else if(a.isObservable(d[c])){if(a.isWritableObservable(d[c]))d[c](a.unwrap(e[c]))}else d[c]=a.unwrap(e[c])})}if(!this.G)return e;m(g,e);return e},destructor:function(){},updateProperties:function(a){this.G=
!1;(a&&a.observableProperties||[]).forEach(function(a){this.G=this.G||{};this.G[a]=!0}.bind(this))}};return k}(t);x=function(a,k,e){function g(e){this.observable=e;this.O=a.observable(e);this.mb=1}return function(a,h){function d(a){if("string"!==typeof a)throw f(a);if(k.a.I(b,a))return b[a];throw Error("No entry for id `"+a+"`.");}function c(c){var d=a(c);if("string"!==typeof d)throw f(d);Object.prototype.hasOwnProperty.call(b,d)?(d=b[d],++d.mb):(c=new g(h.constructor(c)),d=b[d]=c);return d}function f(a){throw Error("Illegal argument: Ids must be strings ('"+
a+"' is of type '"+typeof a+"').");}function m(a){var b=a.observable;a.O(null);a.observable=null;h.destructor(b)}h=h||new e;var b={};this.D=function(a){return c(a).observable};this.Pb=function(a){return c(a).O};this.B=function(c){c=a(c);var e=d(c);--e.mb||(m(e),delete b[c])};this.ac=function(b){return d(a(b)).observable};this.kb=function(c){c.forEach(function(c){var d=a(c);k.a.I(b,d)&&(d=b[d],d.observable||(d.observable=h.constructor(c),d.O(d.observable)))})};this.Aa=function(c){c.forEach(function(c){var d=
a(c);k.a.I(b,d)&&h.updater(b[d].observable,c)})};this.ec=function(a){k.a.Ka(b,function(b,c){var d=a(b);d?c.observable?h.updater(c.observable,d):(c.observable=h.constructor(d),c.O(c.observable)):m(c)})};this.Za=function(a){k.a.Ka(b,function(b,c){a(b)&&m(c)})};this.dispose=function(){this.Za(function(){return!0})}.bind(this)}}(t,q,u);r=function(a){var k,e,g;k=function(a){return function(e,d){return a.a.extend(e,{get stringifyable(){return d()}})}}(a);e=function(a,e){function d(){return 0}function c(a,
b){return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<=b?a<b?-1:0:1}function f(c,d){a.a.extend(c,{get onResultOf(){return this.ka},get reverse(){return this.reverse},get callable(){return this.fa}},{get ka(){return function(a){return h(a,c)}},get reverse(){return function(){return d||b(c)}},get fa(){return c}})}function h(a,b){function c(c,d){return b(a(c),a(d))}f(c);e(c,function(){return{type:"by-function-comparator","function":a.stringifyable,comparator:b.stringifyable}});return c}
function b(a){function b(b,c){return-a(b,c)}f(b,a);e(b,function(){return{type:"reversed-comparator",comparator:a.stringifyable}});return b}f(c);e(c,function(){return{type:"natural-comparator"}});f(d);e(d,function(){return{type:"indifferent-comparator"}});return{Zb:d,pc:c}}(a,k);g=function(a,e){function d(c){a.a.extend(c,{get callable(){return this.fa}},{get fa(){return c}})}return{dc:function(a){function c(c){return-1==a.indexOf(".")?c[a]:eval("owner."+a)}d(c);e(c,function(){return{type:"property-accessor",
propertyName:a}});return c}}}(a,k);a=function(a,e){function d(){return!0}function c(){return!1}function f(c,d){a.a.extend(c,{get and(){return this.sa},get negate(){return this.hb},get onResultOf(){return this.ka},get or(){return this.va},get callable(){return this.fa}},{get sa(){return function(a){return h([c,a])}},get hb(){return function(){return d||l(c)}},get ka(){return function(a){return b(a,c)}},get va(){return function(a){return g([c,a])}},get fa(){return c}})}function h(a){function b(b){for(var c=
0,d=a.length;c<d;++c)if(!a[c](b))return!1;return!0}if(!a.length)return d;f(b);e(b,function(){return{type:"and-predicate",components:a.map(function(a){return a.stringifyable})}});return b}function b(a,b){function c(c){return b(a(c))}f(c);e(c,function(){return{type:"by-function-predicate","function":a.stringifyable,predicate:b.stringifyable}});return c}function l(a){function b(b){return!a(b)}f(b,a);e(b,function(){return{type:"negated-predicate",predicate:a.stringifyable}});return b}function g(a){function b(b){for(var c=
0,d=a.length;c<d;++c)if(a[c](b))return!0;return!1}if(!a.length)return c;f(b);e(b,function(){return{type:"or-predicate",components:a.map(function(a){return a.stringifyable})}});return b}f(c);e(c,function(){return{type:"always-false-predicate"}});f(d);e(d,function(){return{type:"always-true-predicate"}});return{oc:c,Rb:d,sa:h,from:function(a,b){function c(b){return a(b)}f(c);e(c,b);return c},va:g,fc:function(a){function b(b){return a.test(b)}f(b);e(b,function(){return{type:"regular-expression-predicate",
regularExpression:a.source,caseSensitive:!a.ignoreCase,multiline:a.multiline}});return b}}}(a,k);return{V:e,ta:g,P:a,bc:k,ic:function(a,e){return"function"===typeof e||"object"===typeof e?e.stringifyable||e:e}}}(q);r=function(a,k,e){function g(a,e,d,c){this.Mb=a;this.F=e;this.Lb=d;this.Kb=c}g.prototype=k.a.extend({get predicate(){return this.j},get comparator(){return this.l},get offset(){return this.offset},get limit(){return this.h}},{get j(){return this.Mb},get l(){return this.F},get offset(){return this.Lb},
get h(){return this.Kb},normalize:function(){return new g(this.j||e.P.Rb,this.l||e.V.Zb,this.offset||0,this.h||0===this.h?this.h:Number.POSITIVE_INFINITY)},Qa:function(){return new g(a.unwrap(this.j),a.unwrap(this.l),a.unwrap(this.offset),a.unwrap(this.h))},ga:function(a){return this.j===a.j&&this.l===a.l&&this.offset===a.offset&&this.h===a.h}});return g}(t,q,r);r=function(a,k){function e(a,e,d){k.call(this,a,e,d)}var g={fb:function(a){return new k(this.j,this.l,this.offset,a)}};e.prototype=a.a.extend({},
k.prototype,g,{limitedTo:g.fb});return e}(q,r);r=function(a,k){function e(a,e){k.call(this,a,e)}var g={ib:function(a){return new k(this.j,this.l,a)}};e.prototype=a.a.extend({},k.prototype,g,{offsetBy:g.ib});return e}(q,r);r=function(a,k){function e(a){k.call(this,a)}var g={Z:function(a){return new k(this.j,a)}};e.prototype=a.a.extend({},k.prototype,g,{sortedBy:g.Z});return e}(q,r);r=function(a,k){function e(){k.call(this)}var g={W:function(a){return new k(a)}};e.prototype=a.a.extend({},k.prototype,
g,{filteredBy:g.W});return e}(q,r);B=function(a,k){function e(){k.call(this)}e.prototype=a.a.extend({},k.prototype);return e}(q,r);r=function(){function a(a,l){l=l||new f(a);var b=new c(a);h.call(this,l,function(a){return b.ab(a)});this.oa=a;this.g=l;this.b=b;this.T=e.observable(new d);this.o=[];var g=new m.Eb(this.oa,this.g,this.b,this.T);this.Nb=this.Ta(new h.na,g);this.K=e.pureComputed(function(){return g.values().length})}function k(a,c){this.f=a;this.H=c;this.K=e.pureComputed(function(){return a.values().length});
this.s=e.pureComputed(function(){return(g.w.wa(c,function(a){return a.key.M===h.na.Sa})||c[0]).view.values().length})}var e=t,g=q,m=G,h=D,d=w,c=C,f=x;a.prototype={get size(){return this.K},Ta:function(a,c){var b=new h.Ra(a,c,function(){return this.o.splice(this.o.indexOf(b),1)}.bind(this));this.o.push(b);return b},Jb:function(a){var b=g.w.wa(this.o,function(b){return a.ga(b.key)});if(b)return b.D();var c=a.lb(),b=g.w.ob(this.o,function(a){return c.ga(a.key)}).view,b=a.Sb(b);return this.Ta(a,b)},Ob:function(a){this.b.addAll(a);
(new d(a)).R(this.T);this.g.kb(a)},Qb:function(a){var b=[],c=[];a.forEach(function(a){return(this.b.contains(a)?c:b).push(a)}.bind(this));this.b.addAll(b);this.b.za(c);(new d(b,c)).R(this.T);this.g.kb(b);this.g.Aa(c)},Y:function(a){a=(a||function(a){return a})(new B);a=h.na.$a(a).Xa().map(function(a){return this.Jb(a)}.bind(this));var b=a[a.length-1].view;b.ia();return new k(b,a)},gc:function(a){this.b.removeAll(a);(new d([],[],a)).R(this.T);this.g.Za(function(a){return!this.b.Ha(a)}.bind(this))},
hc:function(a){var b=this.b.S();this.b.clear();this.b.addAll(a);(new d(a,[],b)).R(this.T);this.g.ec(function(a){return this.b.jc(a)}.bind(this))},$:function(a){a=this.Y(a);try{return Promise.resolve(new E(a.values.peek().slice()))}finally{a.dispose()}},Aa:function(a){this.b.za(a);(new d([],a)).R(this.T);this.g.Aa(a)},dispose:function(){this.Nb.B();this.g.dispose();if(this.o.length){var a=this.o.length,c=this.o.reduce(function(a,b){return a+b.J},0);window.console.warn("Some views were not or are not yet disposed ("+
a+" views, "+c+" references).")}}};a.prototype=g.a.extend({},h.prototype,{get size(){return this.size},addEntries:a.prototype.Ob,dispose:a.prototype.dispose,addOrUpdateEntries:a.prototype.Qb,openView:a.prototype.Y,removeEntries:a.prototype.gc,replaceEntries:a.prototype.hc,streamValues:a.prototype.$,updateEntries:a.prototype.Aa},a.prototype);var n=e.pureComputed(function(){return!1});k.prototype={get Ia(){return n},get Ja(){return this.s},get Ma(){return e.pureComputed(function(){return{}})},get X(){return this.f.X},
get size(){return this.K},get values(){return this.f.values},dispose:function(){this.H.forEach(function(a){a.B()})}};k.prototype=g.a.extend({get dirty(){return this.Ia},get filteredSize(){return this.Ja},get metadata(){return this.Ma},get observables(){return this.X},get size(){return this.size},get values(){return this.values},dispose:k.prototype.dispose},k.prototype);return a}({});y=function(){function a(a,f,g){g=g||new h(a);var b={};m.call(this,g,function(a){if(!d(b,a))throw Error("No known entry with id `"+
a+"`.");return b[a].value});this.oa=a;this.g=g;this.Va=f;this.b=b;this.K=e.observable(0);this.Ib=e.pureComputed(function(){return this.K()}.bind(this));this.o=[]}function k(a,d,h){function b(a){if(a.j!==v||a.l!==w)return!1;for(var b=0,c=t.length;b<c;++b){var d=u[b];if(t[b]<=a.offset&&d>=a.offset+a.h)return!0}return!1}function c(a,b){if(a.j!==v||a.l!==w){var c=a.j,d=a.l;r=[];t=[];u=[];v=c;w=d}var d=c=a.offset,e=c+a.h,f,g,h;g=f=0;for(h=t.length;f<h;++f){var k=t[g]=t[f],l=u[g]=u[f];d<=l&&e>=k?(d=Math.min(k,
d),e=Math.max(l,e)):++g}t.length=u.length=g;t.push(d);u.push(e>=m().filteredSize?Number.POSITIVE_INFINITY:e);f=0;for(h=b.length;f<h;++f)r[c+f]=b[f]}var f=e.observable(!1),k=e.observable(!1),m=e.observable({unfilteredSize:a.size.peek(),filteredSize:0}),n=g.ja(),q=e.observable(),r=[],t=[],u=[],v=null,w=null,y=e.pureComputed(function(){if(f.peek())return f();var e=d.Qa().normalize();if(b(e))return q(r.slice(e.offset,e.offset+e.h));k(!0);f(!0);window.setTimeout(function(){if(!e.ga(d.Qa().normalize()))return f(!1);
a.Va.issue(e).then(function(b){var d=[];b.values.reduce(function(a,b){return d.push(b)});q(d);delete b.values;a.K(b.unfilteredSize);m(b);c(e,d)}).then(function(){k(!1);f(!1)},function(){f(!1)})})}),x=e.pureComputed(function(){y();var b=q(),b=g.ja(b);A?(A=b.map(function(b){a.Ua(b);return a.g.D(b)}),n.forEach(function(b){a.Wa(b);a.g.B(b)})):(b.forEach(a.Ua.bind(a)),n.forEach(a.Wa.bind(a)));return n=b});this.b=x;var A=null;this.v=e.pureComputed(function(){x();A||(A=n.map(a.g.D));return A});this.v.subscribe(function(){return A=
null},null,"asleep");this.s=e.pureComputed(function(){return k()});this.ha=e.pureComputed(function(){return m()});this.f=e.pureComputed(function(){return m().filteredSize});this.K=e.pureComputed(function(){return x().length});this.H=function(){y.dispose();h()}}var e=t,g=v,m=D,h=x,d=q.a.I;a.prototype={get size(){return this.Ib},Ua:function(a){var c=this.oa(a);d(this.b,c)?(c=this.b[c],++c.J,c.value=a):this.b[c]={J:1,value:a}},Wa:function(a){a=this.oa(a);if(!d(this.b,a))throw Error("Assertion error: Value with id `"+
a+"` was expected to be referenced.");--this.b[a].J||delete this.b[a]},Y:function(a){a=(a||function(a){return a})(new B);var c=m.na.$a(a),d=q.w.wa(this.o,function(a){return c.ga(a.key)});if(d)return d.D().view;a=new k(this,a,function(){return b.B()});var b=new m.Ra(c,a,function(){return this.o.splice(this.o.indexOf(b),1)}.bind(this));this.o.push(b);return a},$:function(a){a=(a||function(a){return a})(new B);return this.Va.issue(a.Qa().normalize()).then(function(a){return a.values})},dispose:function(){this.g.dispose();
if(this.o.length){var a=this.o.length,d=this.o.reduce(function(a,b){return a+b.J},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+d+" references).")}}};a.prototype=q.a.extend({},m.prototype,{get size(){return this.size},dispose:a.prototype.dispose,openView:a.prototype.Y,streamValues:a.prototype.$},a.prototype);k.prototype={get Ia(){return this.s},get Ja(){return this.f},get Ma(){return this.ha},get X(){return this.v},get size(){return this.K},get values(){return this.b},
dispose:function(){this.H()}};k.prototype=q.a.extend({},{get dirty(){return this.Ia},get filteredSize(){return this.Ja},get metadata(){return this.Ma},get observables(){return this.X},get size(){return this.size},get values(){return this.values},dispose:k.prototype.dispose},k.prototype);return a}({});return function(a,k,e,g,m){return{ClientSideDataSource:a,DefaultObservableStateTransitioner:k,ObservableEntries:e,ServerSideDataSource:g,streams:m}}(r,u,x,y,function(a,k){return{streamArray:function(e){return new k(a.ja(e))}}}(v,
E))}"function"===typeof define&&define.amd?define(["knockout"],F):window["ko-data-source"]=F(window.ko);